{% extends 'base.html' %}
{% load static %}

{% block title %}Check-in Guest - {{ pg.name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="bi bi-person-plus"></i> Check-in New Guest</h2>
            <a href="{% url 'hostel:pg_dashboard' pg.id %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" id="checkInForm">
                    {% csrf_token %}
                    
                    <!-- User Account Information -->
                    <div class="row">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-person-circle"></i> User Account Information
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.username.id_for_label }}" class="form-label">Username *</label>
                            {{ form.username }}
                            {% if form.username.errors %}
                                <div class="text-danger small">{{ form.username.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.password.id_for_label }}" class="form-label">Password *</label>
                            {{ form.password }}
                            {% if form.password.errors %}
                                <div class="text-danger small">{{ form.password.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.email.id_for_label }}" class="form-label">Email *</label>
                            {{ form.email }}
                            {% if form.email.errors %}
                                <div class="text-danger small">{{ form.email.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.first_name.id_for_label }}" class="form-label">First Name *</label>
                            {{ form.first_name }}
                            {% if form.first_name.errors %}
                                <div class="text-danger small">{{ form.first_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.last_name.id_for_label }}" class="form-label">Last Name *</label>
                            {{ form.last_name }}
                            {% if form.last_name.errors %}
                                <div class="text-danger small">{{ form.last_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.phone.id_for_label }}" class="form-label">Phone *</label>
                            {{ form.phone }}
                            {% if form.phone.errors %}
                                <div class="text-danger small">{{ form.phone.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label for="{{ form.address.id_for_label }}" class="form-label">Address *</label>
                            {{ form.address }}
                            {% if form.address.errors %}
                                <div class="text-danger small">{{ form.address.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    
                    <!-- Room Assignment -->
                    <div class="row">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-door-open"></i> Room Assignment
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.room.id_for_label }}" class="form-label">Room *</label>
                            {{ form.room }}
                            {% if form.room.errors %}
                                <div class="text-danger small">{{ form.room.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.rent_amount.id_for_label }}" class="form-label">Monthly Rent (₹) *</label>
                            {{ form.rent_amount }}
                            {% if form.rent_amount.errors %}
                                <div class="text-danger small">{{ form.rent_amount.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.check_in_date.id_for_label }}" class="form-label">Check-in Date *</label>
                            {{ form.check_in_date }}
                            {% if form.check_in_date.errors %}
                                <div class="text-danger small">{{ form.check_in_date.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    
                    <!-- Emergency Contact -->
                    <div class="row">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-telephone"></i> Emergency Contact
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.emergency_contact_name.id_for_label }}" class="form-label">Contact Name *</label>
                            {{ form.emergency_contact_name }}
                            {% if form.emergency_contact_name.errors %}
                                <div class="text-danger small">{{ form.emergency_contact_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.emergency_contact_phone.id_for_label }}" class="form-label">Contact Phone *</label>
                            {{ form.emergency_contact_phone }}
                            {% if form.emergency_contact_phone.errors %}
                                <div class="text-danger small">{{ form.emergency_contact_phone.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    
                    <!-- ID Proof -->
                    <div class="row">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-card-text"></i> ID Proof
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.id_proof_type.id_for_label }}" class="form-label">ID Proof Type *</label>
                            {{ form.id_proof_type }}
                            {% if form.id_proof_type.errors %}
                                <div class="text-danger small">{{ form.id_proof_type.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.id_proof_number.id_for_label }}" class="form-label">ID Proof Number *</label>
                            {{ form.id_proof_number }}
                            {% if form.id_proof_number.errors %}
                                <div class="text-danger small">{{ form.id_proof_number.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.id_proof_document.id_for_label }}" class="form-label">ID Proof Document</label>
                            {{ form.id_proof_document }}
                            {% if form.id_proof_document.errors %}
                                <div class="text-danger small">{{ form.id_proof_document.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.profile_photo.id_for_label }}" class="form-label">Profile Photo</label>
                            {{ form.profile_photo }}
                            {% if form.profile_photo.errors %}
                                <div class="text-danger small">{{ form.profile_photo.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    
                    <!-- Security Deposit -->
                    <div class="row">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-shield-check"></i> Security Deposit
                            </h5>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.security_deposit.id_for_label }}" class="form-label">Security Deposit Amount (₹) *</label>
                            {{ form.security_deposit }}
                            {% if form.security_deposit.errors %}
                                <div class="text-danger small">{{ form.security_deposit.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check mt-4">
                                {{ form.deposit_paid }}
                                <label class="form-check-label" for="{{ form.deposit_paid.id_for_label }}">
                                    Deposit Paid
                                </label>
                            </div>
                            {% if form.deposit_paid.errors %}
                                <div class="text-danger small">{{ form.deposit_paid.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex justify-content-end gap-2">
                                <a href="{% url 'hostel:pg_dashboard' pg.id %}" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Cancel
                                </a>
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-person-plus"></i> Check-in Guest
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Auto-fill rent amount when room is selected
    $('#id_room').change(function() {
        const selectedOption = $(this).find('option:selected');
        if (selectedOption.val()) {
            // You can add AJAX call here to get room rent amount
            // For now, we'll leave it for manual entry
        }
    });
    
    // Set today's date as default check-in date
    const today = new Date().toISOString().split('T')[0];
    $('#id_check_in_date').val(today);
});
</script>
{% endblock %}